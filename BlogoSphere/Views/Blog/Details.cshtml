@model BlogoSphere.Models.Blog
@using BlogoSphere.Models
@using Microsoft.AspNet.Identity

@{
	ViewBag.Title = "Details " + Model.Title;

	var datePosts = (List<Post>)ViewBag.DatePosts;
	var postsByDate =
		from p in Model.Posts
		group p by p.Created.Year into yg
		select new
		{
			Year = yg.Key,
			MonthGroups =
				from o in yg
				group o by o.Created.Month into mg
				select new { Month = mg.Key, PostCount = mg.Count() }
		};
}


<div class="container">
	<div class="row">
		@*<div class="col-8">@Html.Action("List", "Post", Model.Posts)</div>*@
		<div class="col-8">
			<div class="d-block w-100 bg-secondary rounded-bottom p-2 mb-3">
				@if (Model.Posts.FirstOrDefault().Blog.Author.Id == User.Identity.GetUserId())
				{
					@Html.ActionLink("Back to My Blogs", "Index", null, new { @class = "btn btn-danger mr-3" })
					@Html.ActionLink("Create New Blogpost", "Create", "Post", new { blogid = Model.Id }, new { @class = "btn btn-danger" })
				}
				else
				{
					@Html.ActionLink("Back to Blogs", "BrowseViews", "Browse", null, new { @class = "btn btn-danger" })
				}
			</div>
			@if (datePosts != null)
			{
				<div class="h5 mt-2">Viewing posts from @datePosts.FirstOrDefault().Created.ToString("MMMM, yyyy") | <a class="text-info" href="@Url.Action("Details")">View all posts</a></div>
				foreach (var post in datePosts)
				{
					@Html.Action("Details", "Post", post)
				}
			}
			else
			{
				foreach (var post in Model.Posts)
				{
					@Html.Action("Details", "Post", post)
				}
			}
		</div>
		<div class="col-4">
			<dl class="mt-0 p-2 bg-secondary shadow rounded-bottom">
				<dd class="bg-light m-2 p-1 rounded">
					<h2 class="text-danger text-center text-uppercase">@Html.DisplayFor(model => model.Title)</h2>
				</dd>
				<dd class="bg-white m-2 p-2 rounded">
					<p style="white-space:pre-wrap;">@Html.DisplayFor(model => model.Body)</p>
				</dd>
			</dl>

			<div class="w-100 bg-secondary shadow rounded p-2">
				<div class="bg-light m-2 p-1 pl-4 pb-3 rounded">
				@foreach (var Year in postsByDate)
				{
					<div class="h5 mt-2"><a class="text-danger" href="@Url.Action("Details", new { year = Year.Year })">@Year.Year</a></div>
					foreach (var Month in Year.MonthGroups)
					{
						<div class="pl-3"><a class="text-danger" href="@Url.Action("Details", new { year = Year.Year, month = Month.Month })">@(new DateTime(Year.Year, Month.Month, 1).ToString("MMMM")) (@Month.PostCount)</a></div>
					}
				}
				</div>
			</div>
		</div>
	</div>
</div>
